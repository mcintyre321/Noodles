@using Mvc.JQuery.Datatables
@model DataTableVm
<table id="@Model.Id" class="display" >
    <thead>
        <tr>
            @foreach (var column in Model.Columns)
            {
                <th>@column</th>
            }
        </tr>
        @if (Model.ColumnFilter)
        {
            <tr>
                @foreach (var column in Model.Columns)
                {
                    <th>@column</th>
                }
            </tr>
        }
    </thead>
    <tbody>
        <tr>
            <td colspan="5" class="dataTables_empty">
                Loading data from server
            </td>
        </tr>
    </tbody>
</table>
<script type="text/javascript">
    $(document).ready(function () {
        var $table = $('#@Model.Id');
        var dt = $table.dataTable({
            "bProcessing": true,
            "bStateSave": true,
            "bServerSide": true,
            "sAjaxSource": "@Html.Raw(Model.AjaxUrl)",
            "fnServerData": function (sSource, aoData, fnCallback) {
                $.ajax({
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    "data": aoData,
                    "success": fnCallback
                });
            }
        });
        @if (Model.ColumnFilter)
        {
            <text>
                dt.columnFilter({  
                    sPlaceHolder: "head:before", 
                    aoColumns: [@string.Join(",", Model.Columns.Select(c => Filter(c).ToHtmlString()))] 
                });
            </text>
        }
</script>
@helper Filter(Tuple<string, Type> column)
{
    if (column.Item2 == typeof(DateTimeOffset))
    {
        @<text>{type: "date-range"}</text>;
    }else
    {
        @<text>{type: "text"}</text>;
    }
}
@*                    {type: "number" },
                    {type: "text", bRegex: true, bSmart: true},
                    null,
                    {type: "select", values: [ 'A', 'B', 'C' ] },
                    {type: "number-range"},
                    {type: "date-range"}*@